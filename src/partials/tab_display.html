
<div class="edit-tab-with-sidemenu">
  <aside class="edit-sidemenu-aside">
    <ul class="edit-sidemenu">
      <li ng-class="{ active: ctrl.subTabIndex === 0 }">
        <a ng-click="ctrl.subTabIndex = 0">Plot</a>
      </li>
      <li
        ng-repeat="serie in ctrl.series"
        ng-class="{ active: ctrl.subTabIndex === $index + 1 }">
        <a ng-click="ctrl.subTabIndex = $index + 1" ng-show="serie.name">{{ serie.name }}</a>
        <a ng-click="ctrl.subTabIndex = $index + 1" ng-show="!serie.name">trace {{ $index + 1 }}</a>
      </li>
      <li>
        <!-- TODO: Better move style to CSS file -->
        <button class="btn btn-success" ng-click="ctrl.createSerie();" style="margin-bottom: 5px;">
          <i class="fa fa-plus"></i>
          Add trace
        </button>
      </li>
      <li>
        <button class="btn btn-danger" ng-click="ctrl.removeSerie($index);" ng-show="ctrl.subTabIndex !== 0">
          <i class="fa fa-trash"></i>
          Delete trace
        </button>
      </li>
    </ul>
  </aside>

  <!-- OPTIONS -->
  <div class="edit-tab-content" ng-if="ctrl.subTabIndex === 0">
    <div class="section gf-form-group">
      <h5 class="section-heading">Options</h5>
      <div class="gf-form">
        <label class="gf-form-label width-7">Type</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.cfg.settings.type" ng-change="ctrl.onConfigChanged()">
            <option value="scatter">Scatter</option>
            <option value="scatter3d">Scatter (3d)</option>
          </select>
        </div>
      </div>

      <div class="gf-form">
        <label class="gf-form-label width-7">Mode</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.cfg.settings.mode" ng-change="ctrl.onConfigChanged()">
            <option value="markers">Markers</option>
            <option value="lines">Lines</option>
            <option value="lines+markers">Lines + Markers</option>
          </select>
        </div>
      </div>

      <div class="gf-form">
        <label class="gf-form-label width-7">Drag</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.cfg.layout.dragmode" ng-change="ctrl.onConfigChanged()">
            <option value="zoom">zoom</option>
            <option value="pan">pan</option>
            <option value="lasso">lasso</option>
            <option value="select">select</option>
          </select>
        </div>
      </div>

      <gf-form-switch class="gf-form" label="Toolbar" label-class="gf-form-label width-7" checked="ctrl.cfg.settings.displayModeBar" on-change="ctrl.onConfigChanged()"></gf-form-switch>
    </div>

    <div class="section gf-form-group">
      <h5 class="section-heading">X</h5>

      <div class="gf-form">
        <label class="gf-form-label width-7">Title</label>
        <input class="gf-form-input width-7" ng-model="ctrl.cfg.layout.xaxis.title" ng-blur="ctrl.refresh();">
      </div>

      <div class="gf-form">
        <label class="gf-form-label width-7">Type</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.cfg.layout.xaxis.type" ng-change="ctrl.onConfigChanged()">
            <option value="-">auto</option>
            <option value="linear">Linear</option>
            <option value="log">Log</option>
            <option value="date">Date</option>
          </select>
        </div>
      </div>

      <div class="gf-form">
        <label class="gf-form-label width-7">Range</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.cfg.layout.xaxis.rangemode" ng-change="ctrl.onConfigChanged()">
            <option value="normal">Auto</option>
            <option value="between">Between</option>
            <option value="tozero">To Zero</option>
            <option value="nonnegative">Non-Negative</option>
          </select>
        </div>
      </div>

      <div class="gf-form" ng-show="ctrl.cfg.layout.xaxis.rangemode === 'between'">
        <label class="gf-form-label width-7">Min</label>
        <input type="number" placeholder="min" ng-model="ctrl.cfg.layout.xaxis.range[0]" class="gf-form-input width-10" ng-blur="ctrl.onConfigChanged()"
        />
      </div>
      <div class="gf-form" ng-show="ctrl.cfg.layout.xaxis.rangemode === 'between'">
        <label class="gf-form-label width-7">Max</label>
        <input type="number" placeholder="max" ng-model="ctrl.cfg.layout.xaxis.range[1]" class="gf-form-input width-10" ng-blur="ctrl.onConfigChanged()"
        />
      </div>

      <gf-form-switch class="gf-form" label="Show Grid:" label-class="gf-form-label width-7" checked="ctrl.cfg.layout.xaxis.showgrid" on-change="ctrl.onConfigChanged()"></gf-form-switch>
      <gf-form-switch class="gf-form" label="Zero Line:" label-class="gf-form-label width-7" checked="ctrl.cfg.layout.xaxis.zeroline" on-change="ctrl.onConfigChanged()"></gf-form-switch>
    </div>

    <div class="section gf-form-group">
      <h5 class="section-heading">Y</h5>

      <div class="gf-form">
        <label class="gf-form-label width-7">Title</label>
        <input class="gf-form-input width-7" ng-model="ctrl.cfg.layout.yaxis.title" ng-blur="ctrl.refresh();">
      </div>

      <div class="gf-form">
        <label class="gf-form-label width-7">Type</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.cfg.layout.yaxis.type" ng-change="ctrl.onConfigChanged()">
            <option value="-">auto</option>
            <option value="linear">Linear</option>
            <option value="log">Log</option>
            <option value="date">Date</option>
          </select>
        </div>
      </div>

      <div class="gf-form">
        <label class="gf-form-label width-7">Range</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.cfg.layout.yaxis.rangemode" ng-change="ctrl.onConfigChanged()">
            <option value="normal">Auto</option>
            <option value="between">Between</option>
            <option value="tozero">To Zero</option>
            <option value="nonnegative">Non-Negative</option>
          </select>
        </div>
      </div>

      <div class="gf-form" ng-show="ctrl.cfg.layout.yaxis.rangemode === 'between'">
        <label class="gf-form-label width-7">Min</label>
        <input type="number" placeholder="min" ng-model="ctrl.cfg.layout.yaxis.range[0]" class="gf-form-input width-10" ng-blur="ctrl.onConfigChanged()"
        />
      </div>
      <div class="gf-form" ng-show="ctrl.cfg.layout.yaxis.rangemode === 'between'">
        <label class="gf-form-label width-7">Max</label>
        <input type="number" placeholder="max" ng-model="ctrl.cfg.layout.yaxis.range[1]" class="gf-form-input width-10" ng-blur="ctrl.onConfigChanged()"
        />
      </div>

      <gf-form-switch class="gf-form" label="Show Grid:" label-class="gf-form-label width-7" checked="ctrl.cfg.layout.yaxis.showgrid" on-change="ctrl.onConfigChanged()"></gf-form-switch>
      <gf-form-switch class="gf-form" label="Zero Line:" label-class="gf-form-label width-7" checked="ctrl.cfg.layout.yaxis.zeroline" on-change="ctrl.onConfigChanged()"></gf-form-switch>
    </div>

    <div class="section gf-form-group" ng-show="ctrl.is3d();">
      <h5 class="section-heading">Z</h5>

      <div class="gf-form">
        <label class="gf-form-label width-7">Title</label>
        <input class="gf-form-input width-7" ng-model="ctrl.cfg.layout.zaxis.title" ng-blur="ctrl.refresh();">
      </div>

      <div class="gf-form">
        <label class="gf-form-label width-7">Type</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.cfg.layout.zaxis.type" ng-change="ctrl.onConfigChanged()">
            <option value="-">auto</option>
            <option value="linear">Linear</option>
            <option value="log">Log</option>
            <option value="date">Date</option>
          </select>
        </div>
      </div>

      <div class="gf-form">
        <label class="gf-form-label width-7">Range</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.cfg.layout.zaxis.rangemode" ng-change="ctrl.onConfigChanged()">
            <option value="normal">Auto</option>
            <option value="between">Between</option>
            <option value="tozero">To Zero</option>
            <option value="nonnegative">Non-Negative</option>
          </select>
        </div>
      </div>

      <div class="gf-form" ng-show="ctrl.cfg.layout.zaxis.rangemode === 'between'">
        <label class="gf-form-label width-7">Min</label>
        <input type="number" placeholder="min" ng-model="ctrl.cfg.layout.zaxis.range[0]" class="gf-form-input width-10" ng-blur="ctrl.onConfigChanged()"
        />
      </div>
      <div class="gf-form" ng-show="ctrl.cfg.layout.zaxis.rangemode === 'between'">
        <label class="gf-form-label width-7">Max</label>
        <input type="number" placeholder="max" ng-model="ctrl.cfg.layout.zaxis.range[1]" class="gf-form-input width-10" ng-blur="ctrl.onConfigChanged()"
        />
      </div>

      <gf-form-switch class="gf-form" label="Show Grid:" label-class="gf-form-label width-7" checked="ctrl.cfg.layout.zaxis.showgrid"
        on-change="ctrl.onConfigChanged()"></gf-form-switch>
      <gf-form-switch class="gf-form" label="Zero Line:" label-class="gf-form-label width-7" checked="ctrl.cfg.layout.zaxis.zeroline"
        on-change="ctrl.onConfigChanged()"></gf-form-switch>
    </div>

  </div>

  <div class="edit-tab-content" ng-repeat="serie in ctrl.series" ng-if="ctrl.subTabIndex === $index + 1">
    <div class="section gf-form-group">
      <h5 class="section-heading">Trace</h5>

      <div class="gf-form">
        <label class="gf-form-label width-7">Name</label>
        <input class="gf-form-input width-7" ng-model="serie.name" ng-blur="ctrl.onChangeName($index, serie.name);">
      </div>
    </div>

    <div class="section gf-form-group">
      <h5 class="section-heading">Metrics</h5>

      <div class="gf-form" ng-value="xMetric = ctrl.data[ctrl.getSerieConfig($index).mapping.x];">
        <label class="gf-form-label width-7">X</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input"
            ng-model="serie.x"
            ng-model-options="{ getterSetter: true }"
            ng-change="ctrl.onConfigChanged()">
            <option ng-repeat="(key, value) in ctrl.data" value="{{key}}">{{key}}</option>
          </select>
        </div>
        &nbsp; {{ xMetric.type }} &nbsp;&nbsp;  <span ng-show="xMetric.missing > 0">Missing: {{ xMetric.missing }}</span>
      </div>

      <div class="gf-form" ng-value="yMetric = ctrl.data[ctrl.getSerieConfig($index).mapping.y];">
        <label class="gf-form-label width-7">Y</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="serie.y" ng-model-options="{ getterSetter: true }" ng-change="ctrl.onConfigChanged()">
            <option ng-repeat="(key, value) in ctrl.data" value="{{key}}">{{key}}</option>
          </select>
        </div>
        &nbsp; {{ yMetric.type }} &nbsp;&nbsp;
        <span ng-show="yMetric.missing > 0">Missing: {{ yMetric.missing }}</span>
      </div>

      <div class="gf-form" ng-value="zMetric = ctrl.data[ctrl.getSerieConfig($index).mapping.z];" ng-show="ctrl.is3d();">
        <label class="gf-form-label width-7">Z</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="serie.z" ng-model-options="{ getterSetter: true }" ng-change="ctrl.onConfigChanged()">
            <option ng-repeat="(key, value) in ctrl.data" value="{{key}}">{{key}}</option>
          </select>
        </div>
        &nbsp; {{ zMetric.type }} &nbsp;&nbsp;
        <span ng-show="zMetric.missing > 0">Missing: {{ zMetric.missing }}</span>
      </div>
    </div>

    <div class="section gf-form-group" ng-show="ctrl.cfg.settings.mode !== 'lines'">
      <h5 class="section-heading">Markers</h5>

      <div class="gf-form">
        <label class="gf-form-label width-7">Symbol</label>
        <metric-segment segment="ctrl.segs[$index].symbol" get-options="ctrl.getSymbolSegs()" on-change="ctrl.onSegsChanged($index)"></metric-segment>
      </div>


      <div class="gf-form">
        <label class="gf-form-label width-7">Size</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.cfg.mapping.size" ng-change="ctrl.onConfigChanged()">
            <option value="">(fixed)</option>
            <option ng-repeat="(key, value) in ctrl.data" value="{{key}}">{{key}}</option>
          </select>
        </div>
      </div>

      <div class="gf-form" ng-show="!ctrl.cfg.mapping.size">
        <label class="gf-form-label width-7">- Pixels</label>
        <input type="number" class="gf-form-input width-7" ng-model="ctrl.getSerieConfig($index).settings.marker.size" spellcheck="false"
          placeholder="5" ng-blur="ctrl.onConfigChanged()" />
      </div>

      <div class="gf-form" ng-show="ctrl.cfg.mapping.size">
        <label class="gf-form-label width-7">- Min</label>
        <input type="number" class="gf-form-input width-7" ng-model="ctrl.getSerieConfig($index).settings.marker.sizemin" spellcheck="false"
          placeholder="5" ng-blur="ctrl.onConfigChanged()" />
        <a href="https://plot.ly/javascript/reference/#scatter-marker-sizemin">
          <i class="fa fa-external-link" aria-hidden="true"></i>
        </a>
      </div>

      <div class="gf-form" ng-show="ctrl.cfg.mapping.size">
        <label class="gf-form-label width-7">- Ref</label>
        <input type="number" class="gf-form-input width-7" ng-model="ctrl.getSerieConfig($index).settings.marker.sizeref" spellcheck="false"
          placeholder="5" ng-blur="ctrl.onConfigChanged()" />
        <a href="https://plot.ly/javascript/reference/#scatter-marker-sizeref">
          <i class="fa fa-external-link" aria-hidden="true"></i>
        </a>
      </div>
      <div class="gf-form" ng-show="ctrl.cfg.mapping.size">
        <label class="gf-form-label width-7">- Mode</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.getSerieConfig($index).settings.marker.sizemode" ng-change="ctrl.onConfigChanged()">
            <option value="diameter">Diameter</option>
            <option value="area">Area</option>
          </select>
        </div>
        <a href="https://plot.ly/javascript/reference/#scatter-marker-sizemode">
          <i class="fa fa-external-link" aria-hidden="true"></i>
        </a>
      </div>

      <div class="gf-form">
        <label class="gf-form-label width-7">Color</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.getSerieConfig($index).settings.color_option" ng-change="ctrl.onConfigChanged()">
            <option value="ramp">Ramp</option>
            <option value="solid">Solid</option>
          </select>
        </div>
      </div>

      <div class="gf-form" ng-show="ctrl.getSerieConfig($index).settings.color_option == 'solid'">
        <label class="gf-form-label width-7">- Solid</label>
        <input type="text" placeholder="text" ng-model="ctrl.getSerieConfig($index).settings.marker.color" class="gf-form-input width-10"
          ng-blur="ctrl.onConfigChanged()" />
        <span class="gf-form-label">
          <spectrum-picker ng-model="ctrl.getSerieConfig($index).settings.marker.color" ng-blur="ctrl.onConfigChanged()" />
        </span>
      </div>

      <div class="gf-form" ng-show="ctrl.getSerieConfig($index).settings.color_option == 'ramp'">
        <label class="gf-form-label width-7">- Metric</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.getSerieConfig($index).mapping.color" ng-change="ctrl.onConfigChanged()">
            <option ng-repeat="(key, value) in ctrl.data" value="{{key}}">{{key}}</option>
          </select>
        </div>
      </div>

      <div class="gf-form" ng-show="ctrl.getSerieConfig($index).settings.color_option != 'solid'">
        <label class="gf-form-label width-7">- Scale</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.getSerieConfig($index).settings.marker.colorscale" ng-change="ctrl.onConfigChanged()">
            <option value="xxx">Default</option>
            <option value="RdBu">RdBu</option>
            <option value="Earth">Earth</option>
            <option value="Blackbody">Blackbody</option>
            <option value="YIOrRd">YIOrRd</option>
            <option value="YIGnBu">YIGnBu</option>
            <option value="Bluered">Bluered</option>
            <option value="Portland">Portland</option>
            <option value="Electric">Electric</option>
            <option value="Jet">Jet</option>
            <option value="Hot">Hot</option>
            <option value="Greys">Greys</option>
            <option value="Greens">Greens</option>
            <option value="Picnic">Picnic</option>
          </select>
        </div>
      </div>
      <gf-form-switch ng-show="ctrl.getSerieConfig($index).settings.color_option != 'solid'" class="gf-form" label="- Show" label-class="gf-form-label width-7"
        checked="ctrl.getSerieConfig($index).settings.marker.showscale" on-change="ctrl.onConfigChanged()"></gf-form-switch>
    </div>

    <div class="section gf-form-group" ng-show="ctrl.cfg.settings.mode !== 'markers'">
      <h5 class="section-heading">Lines</h5>

      <div class="gf-form">
        <label class="gf-form-label width-7">Size</label>
        <input type="number" class="gf-form-input width-6" ng-model="ctrl.getSerieConfig($index).settings.line.width" spellcheck="false" placeholder="2"
          ng-blur="ctrl.onConfigChanged()" />
      </div>
      <div class="gf-form">
        <label class="gf-form-label width-7">Shape</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.getSerieConfig($index).settings.line.shape" ng-change="ctrl.onConfigChanged()">
            <option value="linear">linear</option>
            <option value="spline">spline</option>
            <option value="vhv">vhv</option>
            <option value="hvh">hvh</option>
            <option value="vh">vh</option>
            <option value="hv">hv</option>
          </select>
        </div>
      </div>
      <div class="gf-form">
        <label class="gf-form-label width-7">Dash</label>
        <div class="gf-form-select-wrapper max-width-14">
          <select class="gf-form-input" ng-model="ctrl.getSerieConfig($index).settings.line.dash" ng-change="ctrl.onConfigChanged()">
            <option value="solid">solid</option>
            <option value="dot">dot</option>
            <option value="dash">dash</option>
            <option value="longdash">longdash</option>
            <option value="dashdot">dashdot</option>
            <option value="longdashdot">longdashdot</option>
          </select>
        </div>
      </div>

      <div class="gf-form">
        <label class="gf-form-label width-7">Color</label>
        <input type="text" placeholder="text" ng-model="ctrl.getSerieConfig($index).settings.line.color" class="gf-form-input width-10" ng-blur="ctrl.onConfigChanged()"
        />
        <span class="gf-form-label">
          <spectrum-picker ng-model="ctrl.getSerieConfig($index).settings.line.color" ng-blur="ctrl.onConfigChanged()" />
        </span>
      </div>

    </div>

  </div>

</div>
